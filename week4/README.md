# 기능 구현 목록

## 도메인

### 상품
- 상품은 다음 멤버들을 가진다.
  - 상품 이름
  - 가격
  - 일반 재고
  - 프로모션 재고
  - 프로모션
- 상품은 다음 기능을 수행한다.
  - 지정된 값만큼 일반 재고와 프로모션 재고를 수정할 수 있다.

### 프로모션
- 프로모션은 다음 멤버들을 가진다.
  - 프로모션 이름
  - 구매 수량
  - 증정 수량
  - 시작 날짜
  - 종료 날짜
- 프로모션은 다음 기능을 수행한다.
  - 날짜값을 받아서 현재 프로모션 중인지 확인한다.

### 캐셔
- 캐셔는 다음 기능을 한다.
  - 구매수량, 상품, 프로모션을 통해 구매 유형을 결정한다.
```
구매 수량이 X개,
프로모션이 N + 1이고 A수량,
비프로모션이 B수량일 때

0.
X > A + B인 경우
-> 예외 발생(재고부족)

1.
A == 0인 경우 (전부 비프로모션에서 구매해야 함)
  - 총 구매개수: X개
  - 증정: 0개
  - 재고차감
    - 일반: X개
    - 프로모션: 0개

2.
X <= A인 경우 (전부 프로모션에서 구매할 수 있음)

2-1. 전부 프로모션으로 구매되고, 딱 떨어지는 경우
- X % (N+1) == 0
  - 총 구매개수 X개
  - 증정: X / (N+1)개
  - 재고 차감
    - 일반: 0개
    - 프로모션: X개

2-2. 무료 상품을 가져오지 않은 경우
- X % (N+1) == N && X + 1 <= A
- 가져온다면
  - 총 구매개수 X + 1개
  - 증정: X+1/(N+1)개
    - 일반재고차감: 0개
    - 프로모션재고차감: X + 1개
- 가져오지 않는다면
  - 일반재고차감: 0개
  - 프로모션재고차감: X개

3.
나머지 (일부만 프로모션에서 구매할 수 있음)
- 프로모션 할인이 적용되지 않는 개수 : X - (A / (N+1)) * (N+1)
- 그대로 결제
  - 일반재고차감: X - A개
  - 프로모션재고차감: A개
- 일반결제 빼고 결제
  - 일반재고차감: 0개
  - 프로모션재고차감: A - (X % (N+1))
```

## 파일 데이터 읽기 / 수정하기

### 파일 데이터베이스
- 파일 데이터베이스는 프로그램 시작시 전체 파일을 객체화시켜서 반환한다.
- 파일 데이터베이스는 변경사항을 한번에 배치처리한다.
  - 변경된 객체들을 통해 변경할 위치를 특정할 수 있다.
  - 해당 부분의 값을 바꿀 수 있다.

### 리포지토리
- 리포지토리는 생성되면 파일 데이터베이스를 통해 모든 정보를 불러온다.
- 리포지토리는 프로그램의 변경사항을 캐싱하다가, 한번에 작성하는 역할을 한다. (커밋)
  - 이는 변경된 객체들로 저장된다.
- 리포지토리는 예외상황 발생시 변경사항을 모두 버린다. (롤백)